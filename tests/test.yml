---
# Main test tasks for Diffusion framework
# This file is included from verify.yml and orchestrates all test scenarios

- name: Update apt cache
  ansible.builtin.apt:
    update_cache: true
    cache_valid_time: 3600
  when: ansible_os_family == "Debian"

- name: Set default vars
  ansible.builtin.set_fact:
    verify_ports: []
    verify_docker_containers: []
    verify_docker_rootless: true
    verify_output_in_cmd: []
    verify_uris: []
    postgres_host: "127.0.0.1"
    postgres_port: 5432
    postgres_db: ""
    postgres_user: ""
    postgres_password: ""
    postgres_expected_tables: []
    postgres_expected_records: []
    postgres_expected_roles: []

- name: Include port tests
  ansible.builtin.include_tasks: ports/test_ports.yml
  tags:
    - ports
    - all

- name: Include Docker tests
  ansible.builtin.include_tasks: docker/test_docker.yml
  tags:
    - docker
    - all

- name: Include command tests
  ansible.builtin.include_tasks: cmd/test_cmd.yml
  tags:
    - cmd
    - all

- name: Include PostgreSQL tests
  ansible.builtin.include_tasks: postgres/test_postgres.yml
  tags:
    - postgres
    - all

- name: Include URI tests
  ansible.builtin.include_tasks: uri/test_uri.yml
  tags:
    - uri
    - all
